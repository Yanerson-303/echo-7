<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Survival 2D Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background-color: #4caf50;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      z-index: 2;
    }
    #minimap {
      position: absolute;
      top: 10px;
      right: 10px;
      border: 2px solid white;
      background: #111;
      width: 150px;
      height: 150px;
    }
    #inventory {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      padding: 5px;
      gap: 5px;
      justify-content: center;
    }
    .item {
      width: 40px;
      height: 40px;
      background: gray;
      border: 2px solid white;
      cursor: pointer;
    }
    .selected {
      border: 2px solid yellow;
    }
    .bar {
      width: 200px;
      height: 15px;
      background: red;
      margin: 5px 0;
      border: 1px solid #fff;
      position: relative;
    }
    .bar-inner {
      height: 100%;
      background: limegreen;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="ui">
  <div>Vida</div>
  <div class="bar"><div id="vidaBar" class="bar-inner" style="width: 100%;"></div></div>
  <div>Energía</div>
  <div class="bar"><div id="energiaBar" class="bar-inner" style="width: 100%; background: yellow;"></div></div>
</div>

<canvas id="minimap" width="150" height="150"></canvas>

<div id="inventory">
  <div class="item selected" data-item="pistola"></div>
  <div class="item" data-item="comida"></div>
  <div class="item" data-item="agua"></div>
</div>

<script>
// === Configuración de mapa ===
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const WIDTH = canvas.width;
const HEIGHT = canvas.height;

const worldSize = 2000;
const minimap = document.getElementById('minimap');
const miniCtx = minimap.getContext('2d');

// === Jugador ===
const player = {
  x: 1000,
  y: 1000,
  size: 20,
  speed: 3,
  color: '#ff4444',
  vida: 100,
  energia: 100
};

// === Movimiento ===
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// === Inventario ===
let selectedItem = 'pistola';
document.querySelectorAll('.item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
    item.classList.add('selected');
    selectedItem = item.dataset.item;
  });
});

// === Disparos ===
const bullets = [];
document.addEventListener('click', () => {
  if (selectedItem === 'pistola') {
    bullets.push({ x: player.x, y: player.y, dx: Math.cos(angle), dy: Math.sin(angle), size: 5 });
  }
});

// === Enemigos ===
const enemies = [];
for (let i = 0; i < 10; i++) {
  enemies.push({
    x: Math.random() * worldSize,
    y: Math.random() * worldSize,
    size: 20,
    alive: true
  });
}

// === Árboles ===
const trees = [];
for (let i = 0; i < 100; i++) {
  trees.push({ x: Math.random() * worldSize, y: Math.random() * worldSize, size: 30 });
}

// === Loop de juego ===
let angle = 0;

function update() {
  // Movimiento
  if (keys['w']) player.y -= player.speed;
  if (keys['s']) player.y += player.speed;
  if (keys['a']) player.x -= player.speed;
  if (keys['d']) player.x += player.speed;

  // Límite del mapa
  player.x = Math.max(0, Math.min(worldSize, player.x));
  player.y = Math.max(0, Math.min(worldSize, player.y));

  // Energía baja
  if (keys['w'] || keys['s'] || keys['a'] || keys['d']) {
    player.energia = Math.max(0, player.energia - 0.2);
  } else {
    player.energia = Math.min(100, player.energia + 0.5);
  }

  // Disparos
  bullets.forEach(b => {
    b.x += b.dx * 6;
    b.y += b.dy * 6;
  });

  // Colisión de balas con enemigos
  enemies.forEach(e => {
    bullets.forEach(b => {
      const dx = e.x - b.x;
      const dy = e.y - b.y;
      if (e.alive && Math.hypot(dx, dy) < e.size) {
        e.alive = false;
      }
    });
  });
}

function draw() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);
  ctx.save();

  // Cámara
  const camX = player.x - WIDTH / 2;
  const camY = player.y - HEIGHT / 2;
  ctx.translate(-camX, -camY);

  // Árboles
  ctx.fillStyle = "#2e7d32";
  trees.forEach(t => ctx.fillRect(t.x - t.size/2, t.y - t.size/2, t.size, t.size));

  // Enemigos
  enemies.forEach(e => {
    if (e.alive) {
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(e.x, e.y, e.size/2, 0, Math.PI * 2);
      ctx.fill();
    }
  });

  // Balas
  ctx.fillStyle = "yellow";
  bullets.forEach(b => ctx.fillRect(b.x - 2, b.y - 2, 4, 4));

  // Jugador
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size / 2, 0, Math.PI * 2);
  ctx.fill();

  // Ángulo del mouse (simulado al centro)
  const centerX = camX + WIDTH / 2;
  const centerY = camY + HEIGHT / 2;
  angle = Math.atan2(centerY - player.y, centerX - player.x);

  ctx.restore();

  // UI
  document.getElementById("vidaBar").style.width = player.vida + "%";
  document.getElementById("energiaBar").style.width = player.energia + "%";

  drawMiniMap();
}

function drawMiniMap() {
  miniCtx.clearRect(0, 0, 150, 150);
  miniCtx.fillStyle = "#2e7d32";
  trees.forEach(t => {
    miniCtx.fillRect(t.x / worldSize * 150, t.y / worldSize * 150, 2, 2);
  });

  miniCtx.fillStyle = "black";
  enemies.forEach(e => {
    if (e.alive)
      miniCtx.fillRect(e.x / worldSize * 150, e.y / worldSize * 150, 3, 3);
  });

  miniCtx.fillStyle = "red";
  miniCtx.fillRect(player.x / worldSize * 150, player.y / worldSize * 150, 4, 4);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
